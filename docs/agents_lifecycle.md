AI Agents Lifecycle (Smart Folder Scope) — 통합 & 세분화 문서

개발 우선순위 및 원칙
- 유지보수가 쉽게: 모듈화·인터페이스 명확화, 테스트 커버리지 확보.
- 정확하게: 데이터 검증과 결과 검토 루프 마련, 모의/실제 경로 분리.
- 안정적으로: 실패 감지와 오류 보고 강화, 복구 가능한 플로우 설계.
- 다른 코드와 충돌 없이: 스마트 폴더 외 자원 접근 차단, 의존성 계약 명시.
- 모든 작업 종료 후 즉시 문서 업데이트.

우선 작업 분해
1) Electron ↔ Meeting Pipeline 실연동
   · 모의 스크립트 제거, 실제 MeetingPipeline 호출 래퍼 구현
   · stderr/에러 전파 및 스마트 폴더 컨텍스트 전달 정비
2) 파이프라인 안정화
   · STT 실패 처리 개선, 청크 전사 파일 디스크립터 누수 해결
   · 정책 위반 시 즉시 중단 및 사용자 피드백 경로 마련
3) 요약 품질 보강
   · 하이라이트/액션/결정 탐지 알고리즘 재설계
   · 실패 시 명확한 “감지되지 않음” 응답 제공
4) 지식 에이전트 범위 준수
   · 스마트 폴더 기반 색인 생성·갱신 파이프라인 연결
   · 질의 처리 시 정책 태그/감사 로그 강화
5) 정책·감사 사이클 자동화
   · 스마트 폴더 구조 변경 감지 및 재온보딩 흐름 자동화
   · 교차 에이전트 흐름에서 컨텍스트 경계 검증

공통 전제

데이터 경계: 모든 데이터는 스마트 폴더와 해당 정책에 의해 제한된다.

Context Object: { scope, policyPath, allowed_types, trace_id }가 모든 Cycle에 전달된다.

Fail-Closed 원칙: 정책/권한 오류 시 즉시 중단하고, 사용자에게는 친절 메시지, 관리자 로그에는 상세 기록.

서버리스 환경: 모든 처리·저장은 로컬에서 수행, 로그와 색인은 JSON/JSONL 기반 파일 관리.

권장 스택: Whisper.cpp(STT), Allama(LLaMA/Mistral LLM), MiniLM/Instructor+FAISS(검색).

Cycle 0. 온보딩 (Installation & Provisioning)
세부 단계

옵션 확인: “스마트 폴더만 사용” 플래그 설정.

폴더/정책 선택: 사용자 지정 폴더, 하위 디렉토리 포함 여부, 정책 파일 매핑.

사전 검증: 권한, 경로 유효성, 심볼릭 링크/암호화 상태 체크.

정책 시뮬레이션: 샘플 파일 3~5개로 허용/차단 프리뷰.

구성 저장: smart_folders.json과 정책 파일을 로컬에 저장.

초기화: 각 에이전트가 Context Object를 로딩.

UX 포인트

프리셋 제공(회의 전용/문서 전용).

에러 발생 시 “관리자 권한 필요” 등 구체적 해결책 안내.

예상 문제 & 대응

UI 복잡성 → 기본/고급 모드 분리.

보안팀 요구 미충족 가능 → 정책 상세 모드 제공.

미팅 에이전트
Cycle 1. 데이터 수집

스마트 폴더 감시자로 오디오/회의 문서 탐지.

허용 파일만 컨텍스트 캐시에 등록, 거부 파일은 단순 사유 표시.

Cycle 2. 회의 처리

STT 실행(Whisper.cpp, 5분 단위 chunking).

요약/액션 추출(Allama 모델).

PII 마스킹: 내부는 부분, 외부는 전체 마스킹.

액션 아이템에 Confidence Score와 타임코드 포함.

- Electron 메인 프로세스 → `scripts/run_meeting_agent.py` 브리지를 통해 `MeetingPipeline`을 호출하며 stderr/종료 코드를 UI에 전달한다.
- 브리지는 스마트 폴더 내 최신 오디오/트랜스크립트를 자동 탐색하고 `.ai_agent/meetings/<timestamp>` 경로에 산출물을 저장한다.
- STT 실패 또는 스마트 폴더 범위 위반이 감지되면 즉시 실패(Fail-Closed) 처리하여 사용자에게 오류를 표시한다.
- 하이라이트·액션·결정 추출은 키워드 점수 기반으로 상위 항목만 노출하며, 탐지 실패 시 비어 있는 상태를 그대로 UI에 전달한다.
- 테스트 환경에서는 `backend.api.app_factory`를 간단한 FastAPI 스텁으로 제공해 UI/파이프라인 검증이 가능하도록 한다.

Cycle 3. 결과 제공

UI 패널에 카드형 요약/하이라이트/액션 제공.

스마트 폴더 내부에 Markdown/PDF 저장.

외부 공유는 민감정보 제거본만 export.

Cycle 4. 감사 & 피드백

원클릭 👍👎 피드백.

모든 결과와 피드백은 feedback.jsonl에 기록.

Cycle 5. 재학습

자동 재학습 없음, 피드백 로그 기반 수동 학습.

사용자에게는 “반영 중” 상태 표시.

지식 에이전트
Cycle 1. 색인 준비

허용 문서만 전처리.

문서 chunking(2,000 토큰 단위).

MiniLM/Instructor 임베딩 + FAISS 색인 생성.

Cycle 2. 색인 갱신

폴더 변경 이벤트 감지 후 증분 업데이트.

차단 파일 제외 후 사용자 알림.

Cycle 3. 질의 처리

질의는 스마트 폴더 scope 내에서만 검색.

Allama 모델로 답변 생성.

UX: “자료 없음” vs “정책 차단”을 아이콘/메시지로 구분.

인용은 [문서명: 섹션] 단순 표기.

- Electron 메인 프로세스는 `scripts/run_knowledge_agent.py`를 호출해 단일 JSON 응답을 받고, stderr/종료 코드를 UI에 전달한다.
- 브리지는 LNPChat을 초기화하면서 스마트 폴더 정책과 폴더 경로 기반 필터를 적용하고, 범위 밖 문서는 제거한다.
- 필수 자원(모델/코퍼스/캐시)이 없거나 정책 로드 실패 시 즉시 오류를 반환해 Fail-Closed 행동을 유지한다.

Cycle 4. 결과 소비

UI에 답변과 근거 표시.

대용량 문서는 뷰어 내 검색/스크롤 제공.

Cycle 5. 피드백 & 최적화

Yes/No 피드백.

로그 기반 수동 분석으로 색인 전략 조정.

추가 에이전트 (예: HR, 글로벌 지원)
Cycle 1. 역할 설정

온보딩 시 역할별 폴더/정책 매핑.

Cycle 2. 컨텍스트 준비

허용 데이터만 캐시/요약용으로 정제.

Cycle 3. 업무 실행

정책 검증 후 결과 생성.

Cycle 4. 결과 제공

역할 특화 UI 제공(HR 메모, 글로벌 리포트).

외부 공유는 항상 마스킹된 export만.

Cycle 5. 감사 & 개선

민감 데이터 접근 기록.

정책 위반 발견 시 온보딩 일부 재실행.

공통 지원 사이클

정책 모니터링: 폴더 구조/권한 변경 감지 → 정책 재검증.
Electron 메인 프로세스는 smart_folders.json 및 정책 디렉터리를 감시해 변경 시 즉시 UI에 갱신 신호를 보낸다.

교차 에이전트: Context Object 유지, 불일치 시 차단.

로그 & 메트릭: JSONL 로그, 사용자=간단 카드, 관리자=세부 리포트.
meeting/knowledge 브리지는 data/audit/desktop_agents.jsonl에 실행 결과(성공/실패)를 기록해 Fail-Closed 이벤트를 중앙집중화한다.
Python 스크립트 `scripts/audit_summary.py`로 에이전트별/상태별 감사 이벤트를 요약할 수 있다.

SLA 목표: 회의 요약 <10분, 검색 응답 <5초.

장애 대응: Fail-Closed, 사용자=친절 안내, 관리자=상세 로그.

총괄 정리

원문 장점: 직관적 Cycle 정의.

개선/경량화 장점: 실행 지침·UX 개선·서버리스 대응·리스크 관리.

통합 세분화 버전: 개념 + 실행 지침을 모두 담아 개발팀/운영팀 제출용 문서로 활용 가능.

핵심 원칙:

보안 경계(스마트 폴더) 절대 유지.

사용자 경험은 간결하고 투명하게.

무료 모델+로컬 환경 제약을 전제로 실현 가능한 설계.
