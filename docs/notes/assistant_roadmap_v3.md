# 🚀 AI 데스크톱 비서 로드맵 (갱신판)

## 1) 변경사항 요약
- 지식 관리 + 스마트 검색 **통합** → **지식·검색 비서 (Knowledge & Search Agent)**
- 이메일 옵션 **제외** (추후 IMAP/SMTP 등 무료 연동 가능성 검토)

## 2) 목표 & 원칙
- 하나의 프로그램 + **모듈형 플러그인 구조** (코어는 가볍게, 기능은 On-Demand 로드)
- **스마트 폴더** 중심 사용성 (폴더 = 업무/사람/문서유형 단위 정책 적용)
- **로컬 우선, 클라우드 선택** (폴더별 처리 모드 설정)

## 3) 아키텍처 개요
```
[Desktop 앱 Shell]
   │
   ├─ Core Engine
   │   ├─ Indexer/Scanner
   │   ├─ Retriever
   │   ├─ Summarizer
   │   ├─ Policy Engine (Smart Folder)
   │   ├─ Job Scheduler
   │   └─ Model Manager
   │
   ├─ Plugins (Agents)
   │   ├─ Photo Agent
   │   ├─ Meeting Agent
   │   └─ Knowledge & Search Agent
   │
   └─ UI
       ├─ 설치 마법사
       ├─ 폴더 인스펙터
       └─ 작업 센터
```

## 4) 스마트 폴더 (폴더 단위 정책)
- 자동 분류: **부서/인물/문서유형** 기준 폴더링
- 기능 스코프: 폴더별 허용 **에이전트 선택**
- 보안/처리 모드: `로컬만`, `하이브리드`, `PII 필터링`, `요약만 저장`
- 인덱싱: 실시간/주기/수동, 야간 배치
- 보존정책: 요약/캐시 보존기간, 미리보기 캐시 사용 여부

예시 정책(JSON):
```json
{
  "path": "D:/주연테크/사업기획부",
  "agents": ["meeting", "knowledge_search"],
  "security": {"processing": "local_only", "pii_filter": true},
  "indexing": {"mode": "scheduled", "cron": "0 3 * * *"},
  "retention": {"summary_days": 180, "preview_cache": false}
}
```

## 5) 에이전트별 기능 (MVP)
### 5.1 사진 비서 (Photo Agent)
- 자동 태깅(날짜/장소/인물)
- **중복·유사 사진 정리**, 베스트샷 추천
- 선택 폴더만 인덱싱, GPU/ONNX 최적화

###4.2 회의 비서 (Meeting Agent)

STT (오디오 → 텍스트 변환)

회의 요약, 액션 아이템/결정 사항 추출

프로젝트·부서 폴더 자동 저장

실시간 자막(옵션), 사후 요약(기본)

처리 파이프라인
사용자 음성/회의 파일 → Whisper STT → 요약 생성 → 지정 폴더 저장 → 로컬 벡터 DB 업데이트 → 대화형 검색(QA)

### 5.3 지식·검색 비서 (Knowledge & Search Agent)
- 문서 **임베딩/요약/키포인트**, 자연어 **질의→근거 문서** 연결
- 통합 검색(파일/메타데이터), **출처 링크·미리보기** 제공
- 폴더 스코프 기본, **전역 검색은 명시적으로 전환**

## 6) 단계별 로드맵
- **P0: Core + 스마트 폴더** — 정책 엔진, 폴더별 인덱싱/보안/주기, 기초 검색 *(상태: ✅ 완료 — 스캐너·정책 엔진·스케줄러·모델 매니저 통합 및 테스트 완료)*
- **P1: 지식·검색 고도화** — 요약/Q&A, 출처 링크, 작업 센터 *(상태: 🟡 진행 중 — 파이프라인/검색/챗 통합은 운영 중이나 작업 센터 UI·정책 컨텍스트 표시는 잔여 과제)*
- **P2: 회의 비서 MVP** — STT·사후요약, 실시간 자막(옵션), 액션아이템 링크 *(상태: 🟡 진행 중 — STT·요약·아티팩트 파이프라인 완성, 작업 센터 연동/알림 채널 보강 필요)*
- **P3: 사진 비서 MVP** — 태깅·중복 정리·베스트샷, GPU/CPU 지원 *(상태: 🟡 진행 중 — 스캐폴드/중복 탐지 기초 마련, 베스트샷 평가·정책 연동이 남음)*
- **P4: 하이브리드/관리** — 클라우드 오프로딩, 감사/권한, 모델 자동 선택 *(상태: ⚪ 예정)*

## 7) 성능/자원 목표(권장)
- Idle 메모리: 300–500MB
- 작업 피크: 문서 1.2GB, 사진 2.5GB, STT 1.5GB
- 저장소: 폴더별 캐시 상한 2–10GB, 증분 인덱싱

## 8) 보안/프라이버시
- 폴더 정책 우선(로컬/클라우드/PII), 최소 권한, 감사 로그
- 민감 폴더: 요약만 저장, 본문 캐시 금지

## 9) UX 플로우
1. **설치 마법사**: 폴더 선택 → 처리 모드 → 인덱싱 주기
2. **폴더 인스펙터**: 정책/상태/캐시량/허용 에이전트/재인덱싱
3. **작업 센터**: 최신 요약/액션아이템/알림, 재시도·스케줄
4. **검색 창**: 영역 필터, 근거 하이라이트, 파일 열기

## 10) 테스트 체크리스트
- 대용량 인덱싱 속도/메모리, 스코프 격리, 클라우드 차단
- 사진 중복/유사 정리 정확도, 롤백/복구
- 회의 액션아이템 링크 정확성, 장애 복구(중단/재개)

## 11) KPI
- 문서 탐색 **5분 → 30초**
- 자동 요약 활용률 **40%+**
- 중복 사진 **20% 절감**
- 정책 위반 **0건**

## 12) 향후 고려 (이메일 연동)
- 현재 옵션 제외
- 추후 **IMAP/SMTP** 또는 로컬 클라이언트 연동 검토
- 개인정보/비용 이슈 검토 후 하이브리드 처리 정책 수립

## 12.5) 현재 우선 과제 (2025 Q4)
- **Work Center MVP**: Cycle 2/3 연동을 위해 `ui/screens/`에 작업 센터 화면을 구현하고, 정책 스코프/컨텍스트 노출을 챗/회의 알림까지 연결.
- **Meeting 알림 파이프라인**: `core/agents/meeting/` 산출물을 작업 센터 이벤트 버스(초안)로 전달하는 API/큐를 정의하고 통합 테스트 추가.
- **Operations 대시보드**: `core/infra/` 로그와 KPI 스크립트를 묶어 경보·모니터링 요구사항을 문서화하고, Cycle 5 출력으로 대시보드 통합 계획을 생성.
- **Photo 베스트샷 & 캐시 정책**: 상위 우선순위(Work Center/Meeting/Operations) 완료 후 `core/agents/photo/pipeline.py`의 베스트샷 목적 함수 및 정책 기반 캐시 전략을 확정하고 GPU/ONNX 벤치마크를 수행.

## 12.6) GPT-4 수준 로컬 어시스턴트 장기 목표
- **고성능 로컬 LLM 엔진**: LLaMA 3.1 70B, Qwen2.5 72B 등 GPT-4급 모델을 양자화(gguf/awq)해 GPU에서 서빙하고, vLLM·TensorRT-LLM으로 KV 캐싱과 토큰 스트리밍을 최적화한다.
- **프롬프트·메모리 오케스트레이션**: System/Tool/User 프롬프트를 분리하고, 다중 턴 메모리·사용자 프로필·정책 제약을 자동으로 주입하는 PromptManager/MemoryStore/ToolRouter 구조로 LNPChat을 재구성한다.
- **하이브리드 RAG 고도화**: 문서 청크 동적 분할, semantic caching, adaptive rerank(ANN+CrossEncoder), CoT 유도 프롬프트를 조합해 복잡한 추론/설명/코드 질문에 대응한다.
- **멀티모달 에이전트 통합**: 회의(STT)·사진(비전) 파이프라인을 오디오/이미지 LLM과 연결하고, 전처리→LLM→후처리 단계를 TaskGraph로 통합해 음성/이미지 질의도 자연어로 처리한다.
- **자연어 기반 작업 자동화**: 파일 요약, 보고서 작성, 일정 등록 등 반복 업무를 “툴”로 정의하고, 실행 전 사용자 승인·롤백 로직을 포함한 안전한 오토메이션을 제공한다.
- **지속적 평가·관제**: MMLU/GSM8K/HumEval 등 벤치마크와 사용자 시나리오를 자동 평가 파이프라인에 연결하고, GPU 자원·지연 시간·토큰 사용량을 대시보드로 모니터링한다.

### 실행 로드맵 (제안)
1. **LLM 추론 인프라 확립**: 양자화 모델 선정 → 서빙 스택 구축 → 벤치마크로 품질 확인.
2. **대화 엔진 리팩터링**: PromptManager/MemoryStore 도입, ToolRouter 설계, 세션 로그 기반 회상 기능 추가.
3. **RAG 품질 강화**: chunk 전략 개선, rerank/semantic cache 추가, 질의 유형별 프롬프트 라우팅.
4. **에이전트 통합**: 회의·사진 등 멀티모달 작업을 공통 TaskGraph로 연결하고 UI/CLI에서 자연어 호출 지원.
5. **자동화·도구 체계**: 자연어 명령→작업 실행 플로우에 승인/검증 단계를 삽입하고 안전 가이드 정립.
6. **평가/운영 체계**: AutoEval + 관제 대시보드 구축으로 회귀 테스트와 운영 신뢰성을 확보.

### 현실적 제약과 현재 선택
- **하드웨어 제약**: 주력 개발·운영 환경이 M4 MacBook Air(16GB~24GB RAM, 통합 GPU)로 GPT-4급 70B 모델을 직접 구동하기에는 VRAM과 시스템 메모리가 부족하다.
- **외부 서버 미사용 정책**: 개인정보·내부 문서 보호를 위해 클라우드/원격 GPU 사용을 지양하므로 70B 모델 서빙을 위한 별도 서버 증설은 중장기 과제로 남는다.
- **타협 전략 채택**: 단기적으로 “경량 LLM(8B~20B) + 고도화된 RAG” 방식을 채택해 로컬 환경에서 최대한 높은 품질을 확보하고, 필요 시 하이브리드 확장을 위한 설계를 병행한다.
- **실행 항목**:
  - LLaMA/Qwen 8B~13B 양자화 모델을 Metal 백엔드로 서빙하고, 프롬프트/메모리 오케스트레이션을 도입.
  - 문서 RAG 파이프라인(동적 청크·adaptive rerank·semantic cache)을 고도화해 작은 모델의 답변 품질을 끌어올림.
  - Adaptive chunking과 검색 결과 캐시를 도입해 반복 질의 응답 속도를 개선하고, 향후 semantic cache로 확장 가능한 기반을 마련.
  - 의미 기반 질의 캐시와 rerank/lexical 가중치 튜닝으로 반복 검색·장문 질의 대응 속도를 높이고 품질을 안정화.
  - Whisper STT, 사진 에이전트 등 멀티모달 작업은 경량 모델을 유지하되 TaskGraph 통합과 UI 연동을 진행.
  - 사진 비서 파이프라인을 TaskGraph 단계(스캔→분석→저장)로 구성해 회의 비서와 동일한 실행 모델을 확립.
  - GPT-4급 모델이 반드시 필요해질 경우를 대비해 외부 GPU 서빙 또는 고사양 로컬 장비 증설 옵션을 별도 시나리오로 문서화.
  - LNPChat에 경량 LLM 요약 훅(Ollama 등)을 연결하고, 백엔드 미동작 시 기존 검색 리스트로 폴백하도록 구성.

### 단기 실행 플랜 (M4 MacBook Air 기준)
1. **경량 LLM 준비**: `llama.cpp` 또는 `mlx` 기반 Metal 추론기 설치, LLaMA 3.1 8B/13B·Qwen 14B GGUF/awq 모델 다운로드 후 로컬 추론 테스트.
2. **프롬프트/메모리 구조 도입**: LNPChat을 PromptManager·MemoryStore·ToolRouter 패턴으로 리팩터링해 세션 컨텍스트+정책을 자동 주입.
3. **RAG 고도화**: 문서 chunk 크기 조정, semantic cache, adaptive rerank(ANN + CrossEncoder) 구현으로 작은 모델 답변 품질 보강.
4. **멀티모달 TaskGraph 통합**: Whisper STT·사진 파이프라인을 경량 모델로 유지하되 TaskGraph에 묶고 자연어 명령으로 호출 가능하게 UI/CLI 연동.
5. **평가 루프 구축**: 대표 시나리오(문서 Q&A, 회의 요약 등)에 대한 자동 회귀 테스트와 품질 지표 수집 파이프라인 마련.

## 13) 실행 계획 (작업 순서 & 사이클)
- **Cycle 0 – 기반 정리 및 준비**
1. **기반 정리**
   - 코어 저장소 구조 정리, 패키지/모듈 스켈레톤 생성
   - 스마트 폴더 정책 스키마 초안 및 설정 파일 포맷(예: YAML/JSON) 확정
    - 공용 로깅/테스트 인프라 구축
    - 자료 정리: `docs/cycles/cycle_0.md`에 작업 결과·결정 사항 기록
- **Cycle 1 – P0 (스마트 폴더 + 코어 엔진)**
2. **P0 착수 – 스마트 폴더 + 코어 엔진**
   - 파일 스캐너/인덱서와 정책 엔진 연동
   - 폴더 단위 보안·인덱싱 주기 적용 로직 구현
    - 작업 스케줄러/모델 매니저 기본 기능 개발
    - 자료 정리: `docs/cycles/cycle_1.md`에 구현 내용·테스트·리스크 적재
- **Cycle 2 – P1 (지식·검색 고도화)**
3. **P1 – 지식·검색 고도화**
   - 문서 임베딩/요약 파이프라인 통합, 근거 하이라이트 제공
    - 전역/폴더 스코프 전환 UX 구현, 작업 센터 MVP 작성
    - 자료 정리: `docs/cycles/cycle_2.md`에 주요 변경점과 향후 개선 메모 작성
- **Cycle 3 – P2 (회의 비서 MVP)**
4. **P2 – 회의 비서 MVP**
   - STT 파이프라인 연결, 사후 요약과 액션 아이템 추출
   - 프로젝트/폴더 자동 저장 및 폴더 정책 연동 테스트
   - Whisper 설치 감지 및 `auto` 기본값 개선, 실패 시 명확한 경고 노출
   - `_collect_by_keywords` 등 요약 후처리의 방어 로직 보강 및 회귀 테스트 작성
   - Whisper/KoBART 경로용 스텁 테스트 추가(띄어쓰기·맞춤법 후처리 포함)
   - KoBART 성공 시 휴리스틱 요약 중복 실행 최소화 전략 수립
   - Ollama/BitNet 로컬 요약 백엔드 PoC 계획 수립 및 벤치마크 항목 정의
   - 자료 정리: `docs/cycles/cycle_3.md`에 STT 품질/액션 아이템 검증 결과 기록
- **Cycle 4 – P3 (사진 비서 MVP)**
5. **P3 – 사진 비서 MVP**
   - 이미지 메타/임베딩 추출, 중복 탐지·베스트샷 추천 알고리즘 구현
    - GPU/CPU 선택 정책 및 캐시 관리 정비
    - 자료 정리: `docs/cycles/cycle_4.md`에 모델 성능 및 리소스 통계 정리
- **Cycle 5 – P4 (하이브리드/운영 관리)**
6. **P4 – 하이브리드/운영 관리**
   - 클라우드 오프로딩, 감사 로그, 권한 시스템 강화
    - 정책 기반 모델 자동 선택 및 대시보드/경보 체계 구축
    - 자료 정리: `docs/cycles/cycle_5.md`에 감사/권한 시나리오와 운영 가이드 문서화
- **Cycle 6 – 검증 및 출시 준비**
7. **검증 및 출시 준비**
   - KPI 측정 자동화, 대용량/PII 시나리오 회귀 테스트
    - 설치 마법사 및 작업 센터 UX 폴리싱, 문서화/배포 스크립트 정리
    - 자료 정리: `docs/cycles/cycle_6.md`에 KPI 달성 여부와 릴리스 노트 초안 작성

## 14) 2025-10-17 진행 체크포인트
- **P1 (지식·검색)**: 작업 센터 대시보드가 아직 미구현이며(`ui/screens/home_screen.py` 기준 카드형 홈만 제공), 정책 스코프·컨텍스트 노출은 CLI에서만 지원 → `docs/ux/improvements.md`의 워크센터 항목을 우선 처리.
- **P2 (회의 비서)**: 정제된 로그/통합 아티팩트는 구축 완료(`core/agents/meeting/pipeline.py`), 하지만 작업 센터 알림 경로·실시간 피드 연결이 없어 Cycle 3 체크리스트 잔여 항목을 소화해야 함.
- **P3 (사진 비서)**: 베스트샷 점수 함수와 정책 기반 캐시 관리가 비어 있으므로(`core/agents/photo/pipeline.py`), 평가 지표 설계 및 GPU/ONNX 백엔드 통합 계획을 수립.
- **P4 (하이브리드/운영)**: 감사/오프로딩 유틸은 초안 단계(`core/infra/`), 대시보드/경보 체계와 운영 가이드 정리를 Cycle 5 이후 착수.


  1. 경량 LLM 환경 준비
  2. 프롬프트/메모리 구조 리팩터링
  3. RAG 고도화
  4. 멀티모달 TaskGraph 통합
  5. 평가 루프 구축
